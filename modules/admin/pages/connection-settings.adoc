= Настройка {of-mir}

Администратору необходимо с помощью данной инструкции выполнить настройку системы {dv} для использования {of-mir}.

[#mancons]
== Настройки подключения в {of-mc}

. После установки _{of-mir}_ в _{sett-serv}_ _{of-mc}_ автоматически появляется специальный тип конфигурации _Коннектор к реестру МЧД_.
. В {of-mc} откройте вкладку "Служба {ws}" и подключите новый процесс. Подробнее см. "xref:dev@mgmtconsole:user:worker-service.adoc[]".
+
[WARNING]
====
Чтобы статус передачи доверенности в {cr} изменялся корректно, убедитесь, что учетная запись _Службы {ws}_ обладает правами на изменение карточки доверенности во всех состояниях.

Чтобы обеспечить необходимые права, для вида МЧД в конструкторе состояний выдайте доступ к операции _Запись_. Затем в конструкторе ролей для этого же вида предоставьте права на операцию _Запись_ в состоянии _Отозвана_ для роли _СистемнаяWF_.
====
// .Вкладка "Служба {ws}"
// image::worker-tab.png[Вкладка "Служба {ws}"]
+
. Нажмите на кнопку *Подключить процесс*
. В появившемся окне введите _Имя процесса_ и выберите _Тип конфигурации_ *_Коннектор к реестру МЧД_*.
. В настройках созданного процесса заполните обязательные поля:
+
.Настройки процесса в {of-mc}
image::settings.png[Настройки процесса в {of-mc}]
+
* В выпадающем меню _Сервис по работе с МЧД_ выберите значение *_{kd}_*. +
Поле обязательно для заполнения.
* В поле _Точка подключения_ укажите адрес подключения к сервису {kd}. +
Поле обязательно для заполнения.
+
--
include::ROOT:requirements.adoc[tags=url]
--
+
* В поле _API-ключ_ укажите ключ API для аутентификации, полученный от {kd}. Введённый ключ будет сохранён в зашифрованном виде, после сохранения он не может быть прочитан. +
Поле обязательно для заполнения.
* _Интервал запросов_ -- значение в секундах, в соответствии с которым будут происходить обращения в сервис {kd}. По умолчанию интервал равен `15`. Рекомендуемый интервал `15` сек. +
Поле обязательно для заполнения.
+
* Соединение {dv} -- поле обязательно для заполнения, подробнее см. в разделе "xref:dev@mgmtconsole:user:worker-service.adoc#add[Добавить процесс]" документации модуля {mc}.
* Таймаут -- поле необязательно для заполнения, подробнее см. в разделе "xref:dev@mgmtconsole:user:worker-service.adoc#add[Добавить процесс]" документации модуля {mc}.
* Использовать x86 -- установите флаг, чтобы переключить обработку заданий на версию {of-ws} с указанной разрядностью. Когда флаг снят, используется разрядность x64.
+
NOTE: В {of-mc}, в разделах Очередь "xref:dev@mgmtconsole:user:msg-incoming.adoc[входящих]" и "xref:dev@mgmtconsole:user:msg-outgoing.adoc[исходящих]" сообщений отображаются все действия с МЧД. Если в процессе выполнения запроса возникла ошибка, она будет отображена в {of-mc}, на странице "xref:dev@mgmtconsole:user:msg-outgoing.adoc[Очередь исходящих сообщений]".

[#register]
== Настройки регистрации МЧД

.Чтобы иметь возможность регистрировать МЧД в {cr}, выполните следующие действия:
. Создайте вид карточки для работы с МЧД. Для {wc}а можно воспользоваться готовым примером. Для этого нужно импортировать вид карточки документа ПКД menu:PowersOfAttorney[Data > SolutionOfPOA.sol] из примера "xref:dev@webclient:programmer:other/powers-of-attorney.adoc[]".
. В разметку просмотра МЧД (версия 002) добавьте ЭУ `_Кнопка_`, например, *Зарегистрировать МЧД*, и добавьте скрипт `sendForRegistrationToRegistry` для события `*При щелчке*`.
+
На регистрацию передаётся xml-файл МЧД и файл подписи. После регистрации формируется СКД, статус которой будет проверен автоматически. Результат проверки будет записан в карточку с указанием даты проверки.

[#check]
== Настройки проверки МЧД

.Чтобы иметь возможность проверять статус МЧД в {cr}, полученной от контрагента:
. Создайте вид карточки для работы с МЧД. Для {wc}а можно воспользоваться готовым примером. Для этого нужно импортировать вид карточки документа ПКД menu:PowersOfAttorney[Data > SolutionOfPOA.sol] из примера "xref:dev@webclient:programmer:other/powers-of-attorney.adoc[]".
. В разметку просмотра МЧД (версия 002) добавьте ЭУ `_Кнопка_`, например, *Проверить МЧД*, и добавьте скрипт `checkPowerOfAttorney` для события `*При щелчке*`.
+
Необходимая для проверки информация будет получена из карточки xref:system:ROOT:terms.adoc#attorney[СКД]. Для проверки МЧД в {cr} потребуется передавать её номер и ИНН организации.

[#recall]
== Настройки отзыва МЧД

.Чтобы иметь возможность отозвать МЧД, зарегистрированную в {cr}, выполните следующие действия:
. Создайте вид карточки для работы с МЧД. Для {wc}а можно воспользоваться готовым примером. Для этого нужно импортировать вид карточки документа ПКД menu:PowersOfAttorney[Data > SolutionOfPOA.sol] из примера "xref:dev@webclient:programmer:other/powers-of-attorney.adoc[]".
. В разметку просмотра МЧД (версия 002) добавьте ЭУ `_Кнопка_`, например, *Отозвать МЧД*, и добавьте скрипт `recallPowerOfAttorney` для события `*При щелчке*`.

